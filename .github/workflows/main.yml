name: Project Build and Notify

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # B∆∞·ªõc 1: Checkout m√£ ngu·ªìn
      - uses: actions/checkout@v4

      # C√†i ƒë·∫∑t Node.js
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      # C√†i ƒë·∫∑t ph·ª• thu·ªôc
      - name: Install dependencies
        run: npm ci

      # Ch·∫°y ki·ªÉm th·ª≠
      - name: Run tests
        run: npm test

      # X√¢y d·ª±ng ·ª©ng d·ª•ng
      - name: Build application
        run: npm run build

      # B∆∞·ªõc cu·ªëi: G·ª≠i email th√¥ng b√°o
      - name: Send Mail Notification üìß
        if: always() # Lu√¥n ch·∫°y ƒë·ªÉ th√¥ng b√°o k·ªÉ c·∫£ khi build l·ªói
        uses: dawidd6/action-send-mail@v3
        with:
          # C·∫•u h√¨nh t√†i kho·∫£n g·ª≠i ƒëi (S·ª≠ d·ª•ng Secrets ƒë√£ thi·∫øt l·∫≠p)
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}

          # C·∫•u h√¨nh email
          subject: '[${{ github.repository }}] Build Status: ${{ job.status }}'

          # ƒê·ªäA CH·ªà NG∆Ø·ªúI NH·∫¨N (Recipient)
          to: letandatk16@siu.edu.vn

          # N·ªôi dung email
          body: |
            Hi team,

            The build process for commit ${{ github.sha }} has finished with status: ${{ job.status }}.
            Check the logs here: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}

            Best,
            GitHub Actions Bot

          # Ai s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã l√† ng∆∞·ªùi g·ª≠i
          from: GitHub Actions Bot